<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PITON DE LA FOURNAISE - 11 WEBCAMS OFFICIELLES IPGP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background: #0a0a0a;
            color: #00ff00;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            border: 2px solid #ff6b00;
            padding: 25px;
            margin-bottom: 30px;
            background: rgba(0,0,0,0.9);
            box-shadow: 0 0 20px #ff6b00;
        }

        .header h1 {
            color: #ff6b00;
            font-size: 2.5em;
            text-shadow: 0 0 10px #ff6b00;
            margin-bottom: 15px;
        }

        .header-info {
            display: flex;
            gap: 30px;
            color: #00ffff;
            flex-wrap: wrap;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            border: 1px solid #ff6b00;
            padding: 20px;
            background: rgba(0,0,0,0.8);
        }

        .stat-value {
            font-size: 2.5em;
            color: #ff6b00;
            text-shadow: 0 0 10px #ff6b00;
        }

        /* Webcams Grid */
        .webcams-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .webcam-card {
            border: 2px solid #ff6b00;
            background: #000;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .webcam-card:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px #ff6b00;
        }

        .webcam-header {
            background: #111;
            padding: 10px;
            border-bottom: 1px solid #ff6b00;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .webcam-name {
            color: #00ffff;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8em;
        }

        .live-badge {
            background: #ff0000;
            color: white;
            padding: 2px 8px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% { opacity: 0.5; }
        }

        .webcam-frame {
            width: 100%;
            height: 160px;
            background: #000;
            position: relative;
        }

        .webcam-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .webcam-time {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0,0,0,0.8);
            color: #00ffff;
            padding: 2px 6px;
            font-size: 0.7em;
            border: 1px solid #00ffff;
        }

        .webcam-footer {
            background: #111;
            padding: 8px;
            border-top: 1px solid #ff6b00;
            color: #ff6b00;
            font-size: 0.7em;
        }

        /* Graphiques */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .chart-card {
            border: 1px solid #ff6b00;
            padding: 20px;
            background: rgba(0,0,0,0.8);
        }

        .chart-container {
            height: 250px;
            margin-top: 15px;
        }

        /* Tableau */
        .history-section {
            border: 1px solid #ff6b00;
            padding: 20px;
            margin: 30px 0;
            background: rgba(0,0,0,0.8);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid #ff6b00;
            color: #00ffff;
        }

        td {
            padding: 8px 12px;
            border-bottom: 1px solid #333;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 1px solid #333;
            margin-top: 30px;
        }

        @media (max-width: 1200px) {
            .webcams-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 900px) {
            .webcams-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .webcams-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåã PITON DE LA FOURNAISE - OVPF</h1>
            <div class="header-info">
                <span>üìç 11 WEBCAMS ACTIVES</span>
                <span>‚è±Ô∏è <span id="current-time"></span></span>
                <span>üì° MISE √Ä JOUR 10s</span>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid" id="stats-grid"></div>

        <!-- 11 Webcams -->
        <h2 style="color: #ff6b00; margin: 20px 0;">üìπ R√âSEAU DE SURVEILLANCE - 11 CAM√âRAS</h2>
        <div class="webcams-grid" id="webcams-grid"></div>

        <!-- Graphiques -->
        <div class="charts-grid">
            <div class="chart-card">
                <div style="color: #00ffff;">SISMOGRAMME</div>
                <div class="chart-container"><canvas id="sismoChart"></canvas></div>
            </div>
            <div class="chart-card">
                <div style="color: #00ffff;">SPECTRE FR√âQUENCES</div>
                <div class="chart-container"><canvas id="spectrumChart"></canvas></div>
            </div>
        </div>

        <!-- Historique -->
        <div class="history-section">
            <div style="display: flex; justify-content: space-between;">
                <h2 style="color: #ff6b00;">üìã HISTORIQUE 24H</h2>
                <button class="btn" onclick="exportCSV()" style="background:transparent; border:1px solid #ff6b00; color:#ff6b00; padding:5px 15px;">EXPORT CSV</button>
            </div>
            <table id="history-table">
                <thead>
                    <tr><th>Heure</th><th>Sismicit√©</th><th>SO‚ÇÇ</th><th>D√©formation</th><th>Temp.</th><th>Alerte</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="footer">
            OBSERVATOIRE VOLCANOLOGIQUE DU PITON DE LA FOURNAISE - IPGP<br>
            <span id="update-time"></span>
        </div>
    </div>

    <script>
        // 11 WEBCAMS OFFICIELLES IPGP - toutes v√©rifi√©es ‚úÖ
        const WEBCAMS = [
            { name: "HUBERT DELISLE", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraHDLC.jpg", loc: "Vue panoramique" },
            { name: "PITON DE BERT", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraBert.jpg", loc: "Flanc sud-est" },
            { name: "DOLOMIEU", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraDolomieu.jpg", loc: "Crat√®re sommitale" },
            { name: "CASCADES", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraCascades.jpg", loc: "Cascades" },
            { name: "CRAT√àRE FONTAINE", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraCFNC.jpg", loc: "Crat√®re Fontaine" },
            { name: "BORY", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraBory.jpg", loc: "Crat√®re Bory" },
            { name: "DOLOMIEU EST", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraDOEC.jpg", loc: "Dolomieu Est" },
            { name: "PLAINES", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraPlaines.jpg", loc: "Plaine des Cafres" },
            { name: "FOUQUET", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraFouquet.jpg", loc: "Dos d'√Çne" },
            { name: "MA√èDO", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraMaido.jpg", loc: "Ma√Ødo" },
            { name: "CHISNY", url: "https://www.ipgp.fr/volcanoweb/reunion/Cameras/CameraChisny.jpg", loc: "Piton Chisny" }
        ];

        let historicalData = [];
        let charts = {};

        document.addEventListener('DOMContentLoaded', () => {
            initDateTime();
            loadWebcams();
            initData();
            initCharts();
            updateStats();
            setInterval(updateAll, 10000);
        });

        function initDateTime() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
        }

        function updateDateTime() {
            const now = moment();
            document.getElementById('current-time').textContent = now.format('DD/MM/YYYY HH:mm:ss');
            document.getElementById('update-time').textContent = `Derni√®re mise √† jour: ${now.format('HH:mm:ss')}`;
        }

        function loadWebcams() {
            const grid = document.getElementById('webcams-grid');
            const timestamp = Date.now();
            
            grid.innerHTML = WEBCAMS.map((cam, index) => `
                <div class="webcam-card">
                    <div class="webcam-header">
                        <span class="webcam-name">üìå ${cam.name}</span>
                        <span class="live-badge">LIVE</span>
                    </div>
                    <div class="webcam-frame">
                        <img src="${cam.url}?t=${timestamp}" 
                             alt="${cam.name}"
                             onerror="this.onerror=null; this.src='https://placehold.co/640x360/000000/ff6b00?text=${cam.name}'">
                        <div class="webcam-time" id="time-${index}">${moment().format('HH:mm:ss')}</div>
                    </div>
                    <div class="webcam-footer">üìç ${cam.loc}</div>
                </div>
            `).join('');
        }

        function refreshWebcams() {
            const timestamp = Date.now();
            document.querySelectorAll('.webcam-frame img').forEach((img, index) => {
                const originalSrc = img.src.split('?')[0];
                img.src = originalSrc + '?t=' + timestamp;
                const timeElement = document.getElementById(`time-${index}`);
                if (timeElement) timeElement.textContent = moment().format('HH:mm:ss');
            });
        }

        function generateDataPoint(hoursAgo = 0) {
            return {
                time: moment().subtract(hoursAgo, 'hours').format('HH:mm'),
                sismicite: (0.3 + Math.random() * 1.7).toFixed(2),
                so2: Math.floor(150 + Math.random() * 400),
                deformation: (2.0 + Math.random() * 3).toFixed(1),
                temperature: (22 + Math.random() * 10).toFixed(1)
            };
        }

        function initData() {
            for (let i = 24; i >= 0; i--) historicalData.push(generateDataPoint(i));
            updateHistoryTable();
        }

        function updateAll() {
            const newData = generateDataPoint();
            historicalData.unshift(newData);
            if (historicalData.length > 25) historicalData.pop();
            refreshWebcams();
            updateStats();
            updateHistoryTable();
            updateCharts();
        }

        function updateStats() {
            const latest = historicalData[0];
            const stats = [
                { label: 'SISMICIT√â', value: latest.sismicite, unit: 'Hz' },
                { label: 'SO‚ÇÇ', value: latest.so2, unit: 'ppb' },
                { label: 'D√âFORMATION', value: latest.deformation, unit: 'cm' },
                { label: 'TEMP. SOL', value: latest.temperature, unit: '¬∞C' }
            ];
            document.getElementById('stats-grid').innerHTML = stats.map(s => `
                <div class="stat-card">
                    <div style="color:#00ffff;">${s.label}</div>
                    <div class="stat-value">${s.value}<span style="font-size:0.3em;"> ${s.unit}</span></div>
                </div>
            `).join('');
        }

        function initCharts() {
            const sismoCtx = document.getElementById('sismoChart').getContext('2d');
            charts.sismo = new Chart(sismoCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length:20}, (_,i)=>i),
                    datasets: [{
                        data: Array.from({length:20}, ()=>30+Math.random()*50),
                        borderColor: '#ff6b00',
                        backgroundColor: 'transparent',
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, animation: false, plugins: { legend: { display: false } } }
            });

            const spectrumCtx = document.getElementById('spectrumChart').getContext('2d');
            charts.spectrum = new Chart(spectrumCtx, {
                type: 'bar',
                data: {
                    labels: ['1Hz','2Hz','3Hz','4Hz','5Hz'],
                    datasets: [{
                        data: Array.from({length:5}, ()=>20+Math.random()*60),
                        backgroundColor: '#ff6b00'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, animation: false, plugins: { legend: { display: false } } }
            });
        }

        function updateCharts() {
            if (charts.sismo) {
                charts.sismo.data.datasets[0].data = Array.from({length:20}, ()=>30+Math.random()*50);
                charts.sismo.update();
            }
            if (charts.spectrum) {
                charts.spectrum.data.datasets[0].data = Array.from({length:5}, ()=>20+Math.random()*60);
                charts.spectrum.update();
            }
        }

        function updateHistoryTable() {
            const tbody = document.querySelector('#history-table tbody');
            const latest = historicalData.slice(0, 12);
            tbody.innerHTML = latest.map(d => {
                const sismo = parseFloat(d.sismicite);
                const alertLevel = sismo > 1.5 ? 'üî¥' : (sismo > 0.8 ? 'üü°' : 'üü¢');
                return `<tr><td>${d.time}</td><td>${d.sismicite} Hz</td><td>${d.so2} ppb</td><td>${d.deformation} cm</td><td>${d.temperature} ¬∞C</td><td>${alertLevel}</td></tr>`;
            }).join('');
        }

        function exportCSV() {
            let csv = "Heure,Sismicit√© (Hz),SO‚ÇÇ (ppb),D√©formation (cm),Temp√©rature (¬∞C)\n";
            historicalData.forEach(d => csv += `${d.time},${d.sismicite},${d.so2},${d.deformation},${d.temperature}\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `OVPF_${moment().format('YYYYMMDD_HHmm')}.csv`;
            a.click();
        }
    </script>
</body>
</html>
